============================= test session starts =============================
platform win32 -- Python 3.13.1, pytest-7.4.0, pluggy-1.6.0 -- C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\astir\Desktop\AI_Company\AI_Investor
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-0.21.1, base-url-2.1.0
asyncio: mode=Mode.AUTO
collecting ... collected 6 items

tests/api/test_institutional_api.py::test_create_client_success FAILED
tests/api/test_institutional_api.py::test_get_fee_analytics FAILED
tests/api/test_institutional_api.py::test_get_risk_analytics FAILED
tests/api/test_institutional_api.py::test_get_signatures FAILED
tests/api/test_institutional_api.py::test_get_allocation FAILED
tests/api/test_institutional_api.py::test_configure_white_label FAILED

================================== FAILURES ===================================
_________________________ test_create_client_success __________________________
tests\api\test_institutional_api.py:33: in test_create_client_success
    mock_service.create_client.return_value = Client(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for Client
E   created_date
E     Input should be a valid datetime [type=datetime_type, input_value=None, input_type=NoneType]
E       For further information visit https://errors.pydantic.dev/2.12/v/datetime_type
E   updated_date
E     Input should be a valid datetime [type=datetime_type, input_value=None, input_type=NoneType]
E       For further information visit https://errors.pydantic.dev/2.12/v/datetime_type
___________________________ test_get_fee_analytics ____________________________
tests\api\test_institutional_api.py:62: in test_get_fee_analytics
    response = client.get('/api/v1/institutional/analytics/fees')
venv\Lib\site-packages\werkzeug\test.py:1162: in get
    return self.open(*args, **kw)
venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
venv\Lib\site-packages\asgiref\sync.py:233: in __call__
    raise RuntimeError(
E   RuntimeError: You cannot use AsyncToSync in the same thread as an async event loop - just await the async function directly.
___________________________ test_get_risk_analytics ___________________________
tests\api\test_institutional_api.py:77: in test_get_risk_analytics
    response = client.get('/api/v1/institutional/analytics/risk/client_123')
venv\Lib\site-packages\werkzeug\test.py:1162: in get
    return self.open(*args, **kw)
venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
venv\Lib\site-packages\asgiref\sync.py:233: in __call__
    raise RuntimeError(
E   RuntimeError: You cannot use AsyncToSync in the same thread as an async event loop - just await the async function directly.
_____________________________ test_get_signatures _____________________________
tests\api\test_institutional_api.py:92: in test_get_signatures
    response = client.get('/api/v1/institutional/analytics/signatures/client_123')
venv\Lib\site-packages\werkzeug\test.py:1162: in get
    return self.open(*args, **kw)
venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
venv\Lib\site-packages\asgiref\sync.py:233: in __call__
    raise RuntimeError(
E   RuntimeError: You cannot use AsyncToSync in the same thread as an async event loop - just await the async function directly.
_____________________________ test_get_allocation _____________________________
tests\api\test_institutional_api.py:107: in test_get_allocation
    response = client.get('/api/v1/institutional/analytics/allocation/client_123')
venv\Lib\site-packages\werkzeug\test.py:1162: in get
    return self.open(*args, **kw)
venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
venv\Lib\site-packages\asgiref\sync.py:233: in __call__
    raise RuntimeError(
E   RuntimeError: You cannot use AsyncToSync in the same thread as an async event loop - just await the async function directly.
_________________________ test_configure_white_label __________________________
tests\api\test_institutional_api.py:117: in test_configure_white_label
    mock_service.configure_white_label.return_value = WhiteLabelConfig(
E   pydantic_core._pydantic_core.ValidationError: 3 validation errors for WhiteLabelConfig
E   config_id
E     Field required [type=missing, input_value={'organization_id': 'org_...ing_name': 'Test Brand'}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   created_date
E     Field required [type=missing, input_value={'organization_id': 'org_...ing_name': 'Test Brand'}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   updated_date
E     Field required [type=missing, input_value={'organization_id': 'org_...ing_name': 'Test Brand'}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
=========================== short test summary info ===========================
FAILED tests/api/test_institutional_api.py::test_create_client_success - pyda...
FAILED tests/api/test_institutional_api.py::test_get_fee_analytics - RuntimeE...
FAILED tests/api/test_institutional_api.py::test_get_risk_analytics - Runtime...
FAILED tests/api/test_institutional_api.py::test_get_signatures - RuntimeErro...
FAILED tests/api/test_institutional_api.py::test_get_allocation - RuntimeErro...
FAILED tests/api/test_institutional_api.py::test_configure_white_label - pyda...
============================== 6 failed in 1.14s ==============================
