# Backend Service: Performance (The Scoreboard)

## Overview
The **Performance Service** is the "Meritocracy Engine" of the Sovereign OS. It goes beyond simple P&L to answer the question: *"Was this skill or luck?"* It calculates risk-adjusted returns (True Sharpe), measures distinctiveness from the index (Active Share), and attributes profits to specific investment professionals (Staff Attribution) to determine bonuses.

## Core Components

### 1. Staff Attribution Engine (`staff_attribution.py`)
The Bonus Calculator.
- **Alpha Attribution**: Tracks exactly how much "Alpha" (excess return over benchmark) was generated by each specific employee (Agent or Human).
- **Role Benchmarking**: Compares performance against industry standards for the role (e.g., "Did this Analyst beat the average Analyst base + bonus?").
- **Audit Trail**: Provides the data backing for discretionary bonus pools.

### 2. True Sharpe Calculator (`true_sharpe.py`)
The Private Asset Truth Teller.
- **Volatility Unsmoothing**: Private assets (PE, VC) often look artificially stable because they are not marked-to-market daily. This component mathematically "unsmooths" the return series to reveal the *actual* volatility, preventing false confidence.
- **Risk-Adjusted Return**: Calculates Sharpe Ratio using this "True Volatility".

## Frontend Integration Mapping

| Page / Component | Widget | Service Logic Used | Frontend Status |
| :--- | :--- | :--- | :--- |
| **Auditor Workstation** | Attribution Table | `staff_attribution.calculate_professional_alpha()` | **Implemented** (`AuditorAttribution.jsx`) |
| **Portfolio Analytics** | Sector Brinson | `attribution_service._sector_attribution()` | **Implemented** (`SectorAttribution.jsx`) |
| **Risk Dashboard** | True Sharpe | `true_sharpe.calculate_true_sharpe()` | **Implemented** (`AdvancedRiskDashboard.jsx`) |

## Dependencies
- `decimal`: Required for precise financial performance reporting.

## Usage Examples

### Calculating Alpha for a Portfolio Manager
```python
from services.performance.staff_attribution import StaffAttributionEngine
from decimal import Decimal

attribution = StaffAttributionEngine()

# PM generated 12% return vs 8% benchmark on $50M AUM
result = attribution.calculate_professional_alpha(
    staff_id="pm_tech_fund",
    actual_return=Decimal('0.12'),
    benchmark_return=Decimal('0.08'),
    aum_managed=Decimal('50000000')
)

print(f"Alpha Generated: {result['alpha_bps']} bps")
print(f"Dollar Value Created: ${result['alpha_dollar_value']:,.2f}")
```

### Calculating True Sharpe for a VC Fund
```python
from services.performance.true_sharpe import TrueSharpeCalculator

scorer = TrueSharpeCalculator()

# Fund returned 25%, but with "smoothed" volatility of only 10%
# We estimate True Volatility is actually 25%
metrics = scorer.calculate_true_sharpe(
    annual_return=0.25,
    risk_free_rate=0.04,
    true_volatility=0.25
)

print(f"True Sharpe Ratio: {metrics['true_sharpe']}")
```
