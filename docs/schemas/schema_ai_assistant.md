# Schema: AI Assistant

## File Location
`schemas/ai_assistant.py`

## Purpose
Pydantic models for AI assistant conversations, user preferences, and personalized recommendations. Powers the conversational AI interface that helps users with financial planning, investment decisions, and platform navigation.

---

## Enums

### MessageRole
**Defines the role of each message in a conversation.**

| Value | Description |
|-------|-------------|
| `USER` | Message from the end user |
| `ASSISTANT` | Response from the AI assistant |
| `SYSTEM` | System-level instructions or context |

---

## Models

### ConversationMessage
**A single message within a conversation thread.**

| Field | Type | Default | Description | Usage |
|-------|------|---------|-------------|-------|
| `message_id` | `str` | *required* | Unique message identifier | Tracking individual messages, editing, deletion |
| `conversation_id` | `str` | *required* | Parent conversation reference | Groups messages into threads |
| `role` | `MessageRole` | *required* | Who sent the message | Determines rendering style and context handling |
| `content` | `str` | *required* | Message text content | The actual message displayed/processed |
| `timestamp` | `datetime` | *required* | When message was created | Ordering, analytics, rate limiting |
| `metadata` | `Dict` | `{}` | Additional message context | Stores intent classification, entity extraction results, feature flags |

---

### Conversation
**A complete conversation session between user and assistant.**

| Field | Type | Default | Description | Usage |
|-------|------|---------|-------------|-------|
| `conversation_id` | `str` | *required* | Unique conversation identifier | Primary key, session management |
| `user_id` | `str` | *required* | Owner of the conversation | Access control, personalization context |
| `title` | `Optional[str]` | `None` | Human-readable conversation title | Display in conversation history, auto-generated from first message |
| `messages` | `List[ConversationMessage]` | `[]` | Ordered list of messages | Full conversation history for context |
| `created_date` | `datetime` | *required* | When conversation started | Analytics, retention policies |
| `updated_date` | `datetime` | *required* | Last activity timestamp | Sorting, session timeout management |

---

### UserPreference
**Learned user preference for AI personalization.**

| Field | Type | Default | Description | Usage |
|-------|------|---------|-------------|-------|
| `preference_id` | `str` | *required* | Unique preference identifier | Database key, deduplication |
| `user_id` | `str` | *required* | User this preference belongs to | Personalization lookup |
| `category` | `str` | *required* | Preference type: `risk_tolerance`, `investment_style`, `goals`, etc. | Categorizes preferences for feature-specific retrieval |
| `value` | `str` | *required* | The preference value | Actual preference data (e.g., "conservative", "dividend-focused") |
| `confidence` | `float` | *required, 0-1* | How confident the system is in this preference | Higher confidence = more weight in recommendations; constrained to [0,1] |
| `learned_date` | `datetime` | *required* | When preference was first detected | Preference freshness, relearning triggers |
| `updated_date` | `datetime` | *required* | Last confirmation/update | Preference decay management |

---

### Recommendation
**Personalized recommendation generated by the AI system.**

| Field | Type | Default | Description | Usage |
|-------|------|---------|-------------|-------|
| `recommendation_id` | `str` | *required* | Unique recommendation identifier | Tracking, A/B testing, user feedback |
| `user_id` | `str` | *required* | Target user for recommendation | Access control, personalization |
| `recommendation_type` | `str` | *required* | Category: `investment`, `strategy`, `education`, etc. | Routing to appropriate UI components |
| `title` | `str` | *required* | Short recommendation headline | Card display, notifications |
| `description` | `str` | *required* | Detailed recommendation explanation | Full content for detailed view |
| `confidence` | `float` | *required* | Model confidence score | Ranking recommendations, threshold filtering |
| `reasoning` | `str` | *required* | Explanation of why this was recommended | Transparency, regulatory compliance, user trust |
| `created_date` | `datetime` | *required* | When recommendation was generated | Freshness, expiration logic |

---

## Integration Points

| Service | Usage |
|---------|-------|
| `AssistantService` | Conversation management, message handling |
| `LearningService` | Preference learning and updating |
| `RecommendationEngine` | Generating personalized recommendations |
| `NLPService` | Intent detection, entity extraction |

## API Endpoints
- `POST /api/assistant/conversations` - Start new conversation
- `POST /api/assistant/messages` - Send message to assistant
- `GET /api/assistant/conversations/{id}` - Get conversation history
- `GET /api/assistant/recommendations` - Fetch personalized recommendations
- `GET /api/assistant/preferences` - View learned preferences

## Frontend Components
- Chat interface (FrontendAI)
- Recommendation cards
- Preference management panel
