# Implementation Plan: App Hardening & Improvements (Phases 1-33)

This plan outlines the steps to audit, stabilize, and finalize the archived "App Hardening & Improvements" cycle. The goal is to ensure 100% feature completeness (End-to-End), 100% test coverage, and full integration with live services.

## User Review Required

> [!IMPORTANT]
> - **Rebalancing Service Failures**: 4 unit tests are currently failing due to logic/mock misalignment.
> - **Mock Data**: Several Group A (Analytics) services still rely on mock data helpers in their backend logic.

## Proposed Changes

### [Group A: Analytics & Optimization]

#### [MODIFY] [rebalancing_service.py](file:///c:/Users/astir/Desktop/AI_Company/AI_Investor/services/optimization/rebalancing_service.py)
- Refactor to include helper methods `_execute_trades` and `_record_rebalancing_history`.
- Replace mock weight generation with real calls to `PortfolioAggregator`.

#### [MODIFY] [performance_attribution_service.py](file:///c:/Users/astir/Desktop/AI_Company/AI_Investor/services/analytics/performance_attribution_service.py)
- Replace [_get_portfolio_data](file:///c:/Users/astir/Desktop/AI_Company/AI_Investor/services/analytics/performance_attribution_service.py#265-313) mock block with real integration to `PortfolioAggregator`.
- Wired to live `MarketDataService` for benchmark returns.

### [Cross-Phase Verification]

#### [FIX] Unit Test Alignment
- Synchronize [tests/optimization/test_rebalancing_service.py](file:///c:/Users/astir/Desktop/AI_Company/AI_Investor/tests/optimization/test_rebalancing_service.py) with the updated service logic.
- Ensure all 150+ tests in `tests/unit/` and service-specific folders pass under Python 3.13.

## Verification Plan

### Automated Tests
- Run `python -m pytest tests/` and generate a coverage report via `pytest-cov`.
- Targeting **100% code coverage** for all services in `services/analytics`, `services/optimization`, `services/risk`, and `services/tax`.

### Manual Verification
- **E2E Trace**: Verify `AdvancedPortfolioAnalytics.jsx` dashboard loads and displays data derived from the `analytics_api.py` using live portfolio data.
- **Workflow Check**: Verify the rebalancing approval workflow in `PortfolioOptimizationDashboard.jsx`.
