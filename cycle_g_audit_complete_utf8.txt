============================= test session starts =============================
platform win32 -- Python 3.13.1, pytest-7.4.0, pluggy-1.6.0 -- C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\astir\Desktop\AI_Company\AI_Investor
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-0.21.1, base-url-2.1.0
asyncio: mode=Mode.AUTO
collecting ... collected 112 items

tests/system/test_alert_service.py::test_singleton PASSED                [  0%]
tests/system/test_alert_service.py::test_trigger_alert PASSED            [  1%]
tests/system/test_audit_integrity.py::test_calculate_hash PASSED         [  2%]
tests/system/test_audit_integrity.py::test_log_activity_flow PASSED      [  3%]
tests/system/test_audit_integrity_verify.py::test_verify_chain_integrity PASSED [  4%]
tests/system/test_banking_service.py::test_banking_service_singleton PASSED [  5%]
tests/system/test_banking_service.py::test_create_link_token_simulated PASSED [  6%]
tests/system/test_banking_service.py::test_token_exchange_simulated PASSED [  7%]
tests/system/test_banking_service.py::test_get_accounts_simulated PASSED [  8%]
tests/system/test_brokerage_service.py::test_brokerage_service_singleton PASSED [  8%]
tests/system/test_brokerage_service.py::test_get_status_simulated PASSED [  9%]
tests/system/test_brokerage_service.py::test_get_positions_simulated PASSED [ 10%]
tests/system/test_brokerage_service.py::test_connection_invalid_keys PASSED [ 11%]
tests/system/test_cache_service.py::test_cache_set_get PASSED            [ 12%]
tests/system/test_cache_service.py::test_cache_delete PASSED             [ 13%]
tests/system/test_cache_service.py::test_cache_clear_namespace PASSED    [ 14%]
tests/system/test_cache_service.py::test_cache_missing_key PASSED        [ 15%]
tests/system/test_education_service.py::test_mark_tutorial_complete PASSED [ 16%]
tests/system/test_education_service.py::test_duplicate_completion PASSED [ 16%]
tests/system/test_education_service.py::test_multiple_users PASSED       [ 17%]
tests/system/test_execution_router.py::test_place_order_simulated PASSED [ 18%]
tests/system/test_execution_router.py::test_kill_switch_blocking PASSED  [ 19%]
tests/system/test_execution_router.py::test_risk_limit_rejection PASSED  [ 20%]
tests/system/test_execution_router.py::test_order_routing_error_handling PASSED [ 21%]
tests/system/test_identity_service.py::TestIdentityService::test_singleton_pattern PASSED [ 22%]
tests/system/test_identity_service.py::TestIdentityService::test_calculate_trust_score PASSED [ 23%]
tests/system/test_identity_service.py::TestIdentityService::test_reconcile_identity_structure PASSED [ 24%]
tests/system/test_legal_compliance.py::test_get_user_consent_status PASSED [ 25%]
tests/system/test_legal_compliance.py::test_accept_agreement PASSED      [ 25%]
tests/system/test_logging_service.py::test_json_formatting FAILED        [ 26%]
tests/system/test_logging_service.py::test_trace_correlation FAILED      [ 27%]
tests/system/test_payment_service.py::test_create_checkout_session_simulated PASSED [ 28%]
tests/system/test_payment_service.py::test_subscription_status_mock PASSED [ 29%]
tests/system/test_payment_service.py::test_webhook_simulation_ignore PASSED [ 30%]
tests/system/test_privacy_service.py::test_export_data PASSED            [ 31%]
tests/system/test_privacy_service.py::test_delete_account PASSED         [ 32%]
tests/system/test_rbac.py::test_rbac_access_granted PASSED               [ 33%]
tests/system/test_rbac.py::test_rbac_access_denied PASSED                [ 33%]
tests/system/test_rbac.py::test_role_hierarchy PASSED                    [ 34%]
tests/system/test_reconciliation.py::test_reconciliation_singleton PASSED [ 35%]
tests/system/test_reconciliation.py::test_recon_matching_logic FAILED    [ 36%]
tests/system/test_reconciliation.py::test_unreconciled_items PASSED      [ 37%]
tests/system/test_secret_manager.py::test_secret_manager_singleton PASSED [ 38%]
tests/system/test_secret_manager.py::test_get_secret_default PASSED      [ 39%]
tests/system/test_secret_manager.py::test_get_secret_real_env PASSED     [ 40%]
tests/system/test_secret_manager.py::test_masking_logic PASSED           [ 41%]
tests/system/test_secret_manager.py::test_db_credentials PASSED          [ 41%]
tests/system/test_secret_manager.py::test_status PASSED                  [ 42%]
tests/system/test_security_gateway.py::test_rate_limiting_enforcement PASSED [ 43%]
tests/system/test_security_gateway.py::test_gateway_status PASSED        [ 44%]
tests/system/test_settlement_service.py::test_balance_summary PASSED     [ 45%]
tests/system/test_settlement_service.py::test_currency_conversion PASSED [ 46%]
tests/system/test_settlement_service.py::test_insufficient_funds PASSED  [ 47%]
tests/system/test_settlement_service.py::test_unsupported_currency PASSED [ 48%]
tests/system/test_social_auth.py::test_social_auth_singleton PASSED      [ 49%]
tests/system/test_social_auth.py::test_initiate_auth_flow PASSED         [ 50%]
tests/system/test_social_auth.py::test_handle_callback_existing_user PASSED [ 50%]
tests/system/test_social_auth.py::test_handle_callback_new_user PASSED   [ 51%]
tests/system/test_social_auth.py::test_account_persistence PASSED        [ 52%]
tests/system/test_supply_chain.py::test_supply_chain_singleton PASSED    [ 53%]
tests/system/test_supply_chain.py::test_audit_execution PASSED           [ 54%]
tests/system/test_supply_chain.py::test_sbom_generation PASSED           [ 55%]
tests/system/test_supply_chain.py::test_get_status PASSED                [ 56%]
tests/system/test_totp_service.py::test_totp_singleton PASSED            [ 57%]
tests/system/test_totp_service.py::test_generate_secret PASSED           [ 58%]
tests/system/test_totp_service.py::test_verification_logic PASSED        [ 58%]
tests/system/test_totp_service.py::test_mock_hardware_token PASSED       [ 59%]
tests/system/test_totp_service.py::test_provisioning_uri PASSED          [ 60%]
tests/system/test_tracing_service.py::test_singleton PASSED              [ 61%]
tests/system/test_tracing_service.py::test_initialize PASSED             [ 62%]
tests/system/test_tracing_service.py::test_get_tracer PASSED             [ 63%]
tests/system/test_wallet_service.py::test_wallet_balances_simulated PASSED [ 64%]
tests/system/test_wallet_service.py::test_verify_ownership_simulated PASSED [ 65%]
tests/system/test_wallet_service.py::test_eth_balance_call PASSED        [ 66%]
tests/security/test_compliance_service.py::test_audit_log_hash_chaining PASSED [ 66%]
tests/security/test_compliance_service.py::test_audit_log_tamper_detection PASSED [ 67%]
tests/security/test_compliance_service.py::test_abuse_detection_spoofing PASSED [ 68%]
tests/security/test_compliance_service.py::test_compliance_score_calculation PASSED [ 69%]
tests/security/test_estate_service.py::test_check_heartbeat PASSED       [ 70%]
tests/security/test_estate_service.py::test_confirm_alive PASSED         [ 71%]
tests/security/test_estate_service.py::test_trigger_succession PASSED    [ 72%]
tests/security/test_estate_service.py::test_beneficiary_management PASSED [ 73%]
tests/security/test_estate_service.py::test_update_allocation PASSED     [ 74%]
tests/security/test_estate_service.py::test_get_entity_graph PASSED      [ 75%]
tests/security/test_estate_service.py::test_calculate_estate_tax PASSED  [ 75%]
tests/security/test_estate_service.py::test_get_estate_service PASSED    [ 76%]
tests/security/test_kyc_service.py::TestKYCServiceVerification::test_verify_identity_with_required_docs PASSED [ 77%]
tests/security/test_kyc_service.py::TestKYCServiceVerification::test_verify_identity_missing_docs PASSED [ 78%]
tests/security/test_kyc_service.py::TestKYCServiceVerification::test_verify_identity_accredited_investor PASSED [ 79%]
tests/security/test_kyc_service.py::TestKYCServiceVerification::test_verification_expiration PASSED [ 80%]
tests/security/test_kyc_service.py::TestKYCServiceDocuments::test_upload_document PASSED [ 81%]
tests/security/test_kyc_service.py::TestKYCServiceDocuments::test_upload_document_expiration PASSED [ 82%]
tests/security/test_kyc_service.py::TestKYCServiceDocuments::test_get_user_documents PASSED [ 83%]
tests/security/test_kyc_service.py::TestKYCServiceDocuments::test_get_user_documents_empty PASSED [ 83%]
tests/security/test_kyc_service.py::TestKYCServiceDocuments::test_document_checksum_integrity PASSED [ 84%]
tests/security/test_kyc_service.py::TestKYCServiceFilings::test_get_filing_calendar PASSED [ 85%]
tests/security/test_kyc_service.py::TestKYCServiceFilings::test_filing_calendar_has_13f PASSED [ 86%]
tests/security/test_kyc_service.py::TestKYCServiceFilings::test_generate_13f_xml PASSED [ 87%]
tests/security/test_kyc_service.py::TestKYCServiceFilings::test_13f_xml_contains_holdings PASSED [ 88%]
tests/security/test_kyc_service.py::TestKYCServiceFilings::test_13f_xml_voting_authority PASSED [ 89%]
tests/security/test_kyc_service.py::TestKYCServiceHelpers::test_get_required_documents_basic PASSED [ 90%]
tests/security/test_kyc_service.py::TestKYCServiceHelpers::test_get_required_documents_accredited PASSED [ 91%]
tests/security/test_kyc_service.py::TestKYCServiceCaching::test_verification_cached PASSED [ 91%]
tests/security/test_kyc_service.py::TestKYCServiceCaching::test_verification_not_cached_for_unknown PASSED [ 92%]
tests/reporting/test_generational_global.py::test_endowment_allocation_mix PASSED [ 93%]
tests/reporting/test_generational_global.py::test_geo_risk_aggregation PASSED [ 94%]
tests/reporting/test_wealth_core.py::test_aggregate_net_worth_qp PASSED  [ 95%]
tests/reporting/test_wealth_core.py::test_aggregate_net_worth_retail PASSED [ 96%]
tests/monitoring/test_kafka_monitor_service.py::test_cluster_status_healthy PASSED [ 97%]
tests/monitoring/test_kafka_monitor_service.py::test_cluster_status_down PASSED [ 98%]
tests/monitoring/test_kafka_monitor_service.py::test_throughput_stats_format PASSED [ 99%]
tests/monitoring/test_kafka_monitor_service.py::test_latency_threshold FAILED [100%]

================================== FAILURES ===================================
____________________________ test_json_formatting _____________________________
tests\system\test_logging_service.py:28: in test_json_formatting
    log_entry = json.loads(output)
C:\Python313\Lib\json\__init__.py:346: in loads
    return _default_decoder.decode(s)
C:\Python313\Lib\json\decoder.py:345: in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
C:\Python313\Lib\json\decoder.py:363: in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
E   json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
---------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "C:\Python313\Lib\logging\__init__.py", line 1150, in emit
    msg = self.format(record)
  File "C:\Python313\Lib\logging\__init__.py", line 998, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pythonjsonlogger\core.py", line 272, in format
    self.add_fields(log_data, record, message_dict)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\services\system\logging_service.py", line 21, in add_fields
    now = datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%S.%fZ')
          ^^^^^^^^
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'?
Call stack:
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pytest\__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\config\__init__.py", line 189, in console_main
    code = main()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\config\__init__.py", line 166, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 317, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 270, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 324, in _main
    config.hook.pytest_runtestloop(session=session)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 349, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\python.py", line 1788, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\tests\system\test_logging_service.py", line 25, in test_json_formatting
    logger.info("Test message", extra={'custom_field': 'value'})
Message: 'Test message'
Arguments: ()
------------------------------ Captured log call ------------------------------
INFO     test_json:test_logging_service.py:25 Test message
___________________________ test_trace_correlation ____________________________
tests\system\test_logging_service.py:57: in test_trace_correlation
    log_entry = json.loads(output)
C:\Python313\Lib\json\__init__.py:346: in loads
    return _default_decoder.decode(s)
C:\Python313\Lib\json\decoder.py:345: in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
C:\Python313\Lib\json\decoder.py:363: in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
E   json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
---------------------------- Captured stderr call -----------------------------
--- Logging error ---
Traceback (most recent call last):
  File "C:\Python313\Lib\logging\__init__.py", line 1150, in emit
    msg = self.format(record)
  File "C:\Python313\Lib\logging\__init__.py", line 998, in format
    return fmt.format(record)
           ~~~~~~~~~~^^^^^^^^
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pythonjsonlogger\core.py", line 272, in format
    self.add_fields(log_data, record, message_dict)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\services\system\logging_service.py", line 21, in add_fields
    now = datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%S.%fZ')
          ^^^^^^^^
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'?
Call stack:
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pytest\__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\config\__init__.py", line 189, in console_main
    code = main()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\config\__init__.py", line 166, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 317, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 270, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 324, in _main
    config.hook.pytest_runtestloop(session=session)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\main.py", line 349, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 341, in from_call
    result: Optional[TResult] = func()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\runner.py", line 169, in pytest_runtest_call
    item.runtest()
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\python.py", line 1788, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\_pytest\python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
  File "C:\Python313\Lib\unittest\mock.py", line 1424, in patched
    return func(*newargs, **newkeywargs)
  File "C:\Users\astir\Desktop\AI_Company\AI_Investor\tests\system\test_logging_service.py", line 54, in test_trace_correlation
    logger.info("Trace correlation test")
Message: 'Trace correlation test'
Arguments: ()
------------------------------ Captured log call ------------------------------
INFO     test_trace:test_logging_service.py:54 Trace correlation test
__________________________ test_recon_matching_logic __________________________
tests\system\test_reconciliation.py:14: in test_recon_matching_logic
    assert report["matched_count"] >= 2
E   assert 1 >= 2
___________________________ test_latency_threshold ____________________________
tests\monitoring\test_kafka_monitor_service.py:51: in test_latency_threshold
    assert service.bootstrap_servers == "localhost:9092"
E   AssertionError: assert '127.0.0.1:9092' == 'localhost:9092'
E     - localhost:9092
E     + 127.0.0.1:9092
============================== warnings summary ===============================
venv\Lib\site-packages\pythonjsonlogger\jsonlogger.py:11
  C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\pythonjsonlogger\jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/system/test_identity_service.py::TestIdentityService::test_reconcile_identity_structure
  C:\Users\astir\Desktop\AI_Company\AI_Investor\services\system\identity_service.py:67: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "last_updated": datetime.utcnow().isoformat()

tests/system/test_privacy_service.py::test_export_data
  C:\Users\astir\Desktop\AI_Company\AI_Investor\services\system\privacy_service.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "exported_at": datetime.utcnow().isoformat(),

tests/system/test_rbac.py::test_rbac_access_granted
tests/system/test_rbac.py::test_rbac_access_denied
tests/system/test_rbac.py::test_role_hierarchy
tests/system/test_rbac.py::test_role_hierarchy
tests/system/test_social_auth.py::test_handle_callback_existing_user
tests/system/test_social_auth.py::test_handle_callback_new_user
tests/system/test_social_auth.py::test_account_persistence
tests/system/test_social_auth.py::test_account_persistence
  C:\Users\astir\Desktop\AI_Company\AI_Investor\web\auth_utils.py:26: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'iat': datetime.datetime.utcnow(),

tests/system/test_rbac.py::test_rbac_access_granted
tests/system/test_rbac.py::test_rbac_access_denied
tests/system/test_rbac.py::test_role_hierarchy
tests/system/test_rbac.py::test_role_hierarchy
tests/system/test_social_auth.py::test_handle_callback_existing_user
tests/system/test_social_auth.py::test_handle_callback_new_user
tests/system/test_social_auth.py::test_account_persistence
tests/system/test_social_auth.py::test_account_persistence
  C:\Users\astir\Desktop\AI_Company\AI_Investor\web\auth_utils.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=expiration_minutes)

tests/system/test_supply_chain.py::test_sbom_generation
  C:\Users\astir\Desktop\AI_Company\AI_Investor\services\system\supply_chain_service.py:59: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
    import pkg_resources

tests/system/test_wallet_service.py::test_eth_balance_call
  C:\Users\astir\Desktop\AI_Company\AI_Investor\venv\Lib\site-packages\websockets\legacy\__init__.py:6: DeprecationWarning: websockets.legacy is deprecated; see https://websockets.readthedocs.io/en/stable/howto/upgrade.html for upgrade instructions
    warnings.warn(  # deprecated in 14.0 - 2024-11-09

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/system/test_logging_service.py::test_json_formatting - json.deco...
FAILED tests/system/test_logging_service.py::test_trace_correlation - json.de...
FAILED tests/system/test_reconciliation.py::test_recon_matching_logic - asser...
FAILED tests/monitoring/test_kafka_monitor_service.py::test_latency_threshold
================= 4 failed, 108 passed, 21 warnings in 5.67s ==================
